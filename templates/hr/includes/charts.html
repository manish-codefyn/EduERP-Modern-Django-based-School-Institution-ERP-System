<div class="row g-3">

    <!-- Attendance Chart -->
    <div class="col-md-6 col-sm-12">
        <div class="card shadow-sm" style="background: var(--card-bg); color: var(--text-color);">
            <div class="card-body">
                <h6 class="card-title mb-3">Monthly Attendance</h6>
                <!-- <canvas id="attendanceChart" height="200"></canvas> -->
            </div>
        </div>
    </div>

    <!-- Leave Status Chart -->
    <div class="col-md-6 col-sm-12">
        <div class="card shadow-sm" style="background: var(--card-bg); color: var(--text-color);">
            <div class="card-body">
                <h6 class="card-title mb-3">Leave Status</h6>
                <canvas id="leaveChart" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- Payroll Chart -->
    <div class="col-md-6 col-sm-12">
        <div class="card shadow-sm" style="background: var(--card-bg); color: var(--text-color);">
            <div class="card-body">
                <h6 class="card-title mb-3">Payroll Distribution</h6>
                <canvas id="payrollChart" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- Department Distribution Chart -->
    <div class="col-md-6 col-sm-12">
        <div class="card shadow-sm" style="background: var(--card-bg); color: var(--text-color);">
            <div class="card-body">
                <h6 class="card-title mb-3">Employees by Department</h6>
                <canvas id="departmentChart" height="200"></canvas>
            </div>
        </div>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Chart.js Scripts -->
<!-- Chart.js Scripts -->
<script>
    // Store chart instances globally
    let chartInstances = {
        attendance: null,
        leave: null,
        payroll: null,
        department: null
    };

    // Function to destroy existing charts
    function destroyCharts() {
        Object.values(chartInstances).forEach(chart => {
            if (chart) {
                chart.destroy();
            }
        });
        chartInstances = {
            attendance: null,
            leave: null,
            payroll: null,
            department: null
        };
    }

    // Function to initialize charts
    function initializeCharts() {
        // Destroy existing charts first
        destroyCharts();

        // Monthly Attendance Bar Chart
        const attendanceCtx = document.getElementById('attendanceChart').getContext('2d');
        chartInstances.attendance = new Chart(attendanceCtx, {
            type: 'bar',
            data: {
                labels: {{ attendance_labels|safe }},
                datasets: [{
                    label: 'Present',
                    data: {{ attendance_present|safe }},
                    backgroundColor: 'rgba(var(--accent-color-rgb), 0.7)',
                    borderColor: 'rgba(var(--accent-color-rgb), 1)',
                    borderWidth: 1
                },
                {
                    label: 'Absent',
                    data: {{ attendance_absent|safe }},
                    backgroundColor: 'rgba(220,53,69,0.7)',
                    borderColor: 'rgba(220,53,69,1)',
                    borderWidth: 1
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Leave Status Pie Chart
        const leaveCtx = document.getElementById('leaveChart').getContext('2d');
        chartInstances.leave = new Chart(leaveCtx, {
            type: 'doughnut',
            data: {
                labels: ['Approved', 'Pending', 'Rejected'],
                datasets: [{
                    data: {{ leave_data|safe }},
                    backgroundColor: [
                        'rgba(40,167,69,0.7)',
                        'rgba(255,193,7,0.7)',
                        'rgba(220,53,69,0.7)'
                    ],
                    borderColor: [
                        'rgba(40,167,69,1)',
                        'rgba(255,193,7,1)',
                        'rgba(220,53,69,1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false 
            }
        });

        // Payroll Distribution Line Chart
        const payrollCtx = document.getElementById('payrollChart').getContext('2d');
        chartInstances.payroll = new Chart(payrollCtx, {
            type: 'line',
            data: {
                labels: {{ payroll_labels|safe }},
                datasets: [{
                    label: 'Payroll ($)',
                    data: {{ payroll_data|safe }},
                    backgroundColor: 'rgba(52, 152, 219,0.2)',
                    borderColor: 'rgba(52, 152, 219,1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Department Distribution Pie Chart
        const departmentCtx = document.getElementById('departmentChart').getContext('2d');
        chartInstances.department = new Chart(departmentCtx, {
            type: 'doughnut',
            data: {
                labels: {{ department_labels|safe }},
                datasets: [{
                    data: {{ department_data|safe }},
                    backgroundColor: [
                        'rgba(52,152,219,0.7)',
                        'rgba(40,167,69,0.7)',
                        'rgba(255,193,7,0.7)',
                        'rgba(220,53,69,0.7)',
                        'rgba(108,117,125,0.7)'
                    ],
                    borderColor: [
                        'rgba(52,152,219,1)',
                        'rgba(40,167,69,1)',
                        'rgba(255,193,7,1)',
                        'rgba(220,53,69,1)',
                        'rgba(108,117,125,1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false 
            }
        });
    }

    // Initialize charts when page loads
    document.addEventListener('DOMContentLoaded', function() {
        initializeCharts();
    });

    // Also destroy charts before page unload (useful for SPAs)
    window.addEventListener('beforeunload', function() {
        destroyCharts();
    });
</script>