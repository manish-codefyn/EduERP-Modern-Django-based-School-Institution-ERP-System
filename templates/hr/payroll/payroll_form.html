{% extends 'hr/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Create Payroll - {{ organization.name|default:"ERP System" }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css">

{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-12 card card-custom p-3">

            <!-- Header -->
            <div class="mb-4 detail-card-header rounded-4">
                <h1 class="h3 fw-bold">Create Payroll</h1>
                <p class="text-custom mb-0">Enter payroll details for staff</p>
            </div>

            <form method="post" novalidate>
                {% csrf_token %}

                <!-- Staff & Period -->
                <div class="card-section">
                    <h5>Staff & Period</h5>
                    <div class="row g-3">
                        <div class="col-md-6">{{ form.staff|as_crispy_field }}</div>
                        <div class="col-md-3">{{ form.month|as_crispy_field }}</div>
                        <div class="col-md-3">{{ form.year|as_crispy_field }}</div>
                    </div>
                </div>

                <!-- Earnings -->
                <div class="card-section">
                    <h5>Earnings</h5>
                    <div class="row g-3">
                        <div class="col-md-6">{{ form.basic_salary|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.house_rent_allowance|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.travel_allowance|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.medical_allowance|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.special_allowance|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.performance_bonus|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.other_allowances|as_crispy_field }}</div>
                    </div>
                </div>

                <!-- Deductions -->
                <div class="card-section">
                    <h5>Deductions</h5>
                    <div class="row g-3">
                        <div class="col-md-6">{{ form.professional_tax|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.provident_fund|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.income_tax|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.insurance|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.loan_deductions|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.other_deductions|as_crispy_field }}</div>
                    </div>
                </div>

                <!-- Payment Details -->
                <div class="card-section">
                    <h5>Payment Details</h5>
                    <div class="row g-3">
                        <div class="col-md-6">{{ form.payment_date|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.payment_mode|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.payment_reference|as_crispy_field }}</div>
                        <div class="col-md-6">{{ form.payment_status|as_crispy_field }}</div>
                    </div>
                </div>

                <div class="d-flex justify-content-end gap-2">
                    <a href="{% url 'hr:payroll_list' %}" class="btn btn-secondary">Cancel</a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-plus-circle me-1"></i> Create Payroll
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    $('select').select2({ theme: 'bootstrap-5', width: '100%' });
});
</script>
{% endblock %}
