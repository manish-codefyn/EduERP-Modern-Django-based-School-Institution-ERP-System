{% extends 'base.html' %}
{% load static %}
{% block title %} {{ teacher.get_full_name }} - Teacher Details - {{ organization.name|default:"School ERP System" }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css">
<style>
.teacher-profile-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
}
.stats-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}
.stats-card:hover {
    transform: translateY(-2px);
}
.badge-custom {
    font-size: 0.85rem;
    padding: 0.5rem 1rem;
}
.teacher-photo {
    width: 150px;
    height: 150px;
    object-fit: cover;
    border: 4px solid white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">

    <!-- Header Section -->
    <div class="teacher-profile-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb breadcrumb-dark">
                        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'teacher_list' %}">Teachers</a></li>
                        <li class="breadcrumb-item active" aria-current="page">{{ teacher.get_full_name }}</li>
                    </ol>
                </nav>
                <div class="d-flex align-items-center">
                    {% if teacher.photo %}
                    <img src="{{ teacher.photo.url }}" alt="{{ teacher.get_full_name }}" 
                         class="teacher-photo rounded-circle me-4">
                    {% else %}
                    <div class="rounded-circle bg-white text-primary d-flex align-items-center justify-content-center me-4 teacher-photo">
                        <i class="bi bi-person display-4"></i>
                    </div>
                    {% endif %}
                    <div>
                        <h1 class="display-6 fw-bold mb-1">{{ teacher.get_full_name }}</h1>
                        <p class="lead mb-2 opacity-75">{{ teacher.get_designation_display }}</p>
                        <div class="d-flex flex-wrap gap-2">
                            <span class="badge bg-light text-dark">
                                <i class="bi bi-id-card me-1"></i>{{ teacher.employee_id }}
                            </span>
                            <span class="badge bg-{% if teacher.is_active %}success{% else %}secondary{% endif %}">
                                <i class="bi bi-{% if teacher.is_active %}check{% else %}x{% endif %}-circle me-1"></i>
                                {% if teacher.is_active %}Active{% else %}Inactive{% endif %}
                            </span>
                            {% if teacher.is_class_teacher %}
                            <span class="badge bg-warning">
                                <i class="bi bi-crown me-1"></i>Class Teacher
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-md-end">
                <div class="d-flex gap-2 justify-content-md-end flex-wrap">
                    <div class="btn-group">
                        <a href="{% url 'export_teacher_detail' teacher.pk %}?format=pdf" class="btn btn-light">
                            <i class="bi bi-download me-1"></i> Export PDF
                        </a>
                        <button type="button" class="btn btn-light dropdown-toggle dropdown-toggle-split"
                                data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="visually-hidden">Toggle Dropdown</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item" href="{% url 'export_teacher_detail' teacher.pk %}?format=csv">
                                    <i class="bi bi-filetype-csv me-2"></i> Export CSV
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'export_teacher_detail' teacher.pk %}?format=excel">
                                    <i class="bi bi-filetype-xlsx me-2"></i> Export Excel
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="{% url 'teacher_id_card_default' teacher.pk %}">
                                    <i class="bi bi-person-badge me-2"></i> Generate ID Card
                                </a>
                            </li>
                        </ul>
                    </div>
                    {% if request.user.is_superadmin %}
                    <a href="{% url 'teacher_edit' teacher.pk %}" class="btn btn-primary">
                        <i class="bi bi-pencil me-1"></i> Edit
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card stats-card">
                <div class="card-body text-center">
                    <i class="bi bi-building display-6 text-primary mb-2"></i>
                    <h6 class="text-custom">Organization Type</h6>
                    <h4 class="fw-bold">{{ teacher.get_organization_type_display }}</h4>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card stats-card">
                <div class="card-body text-center">
                    <i class="bi bi-book display-6 text-info mb-2"></i>
                    <h6 class="text-custom">Department</h6>
                    <h4 class="fw-bold">{{ teacher.get_department_display|default:"Not assigned" }}</h4>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card stats-card">
                <div class="card-body text-center">
                    <i class="bi bi-clock-history display-6 text-warning mb-2"></i>
                    <h6 class="text-custom">Experience</h6>
                    <h4 class="fw-bold">{{ teacher.get_teaching_experience }} years</h4>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card stats-card">
                <div class="card-body text-center">
                    <i class="bi bi-cash-coin display-6 text-success mb-2"></i>
                    <h6 class="text-custom">Salary</h6>
                    <h4 class="fw-bold">₹{{ teacher.salary|default:"0" }}</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row g-4">
        <!-- Personal Information -->
        <div class="col-lg-6">
            <div class="card card-custom">
                <div class="card-header detail-card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-person me-2"></i>Personal Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Full Name</label>
                            <p class="fw-semibold">{{ teacher.get_full_name }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Employee ID</label>
                            <p class="fw-semibold">{{ teacher.employee_id }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Email</label>
                            <p class="fw-semibold">
                                <a href="mailto:{{ teacher.email }}" class="text-decoration-none">
                                    {{ teacher.email }}
                                </a>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Mobile</label>
                            <p class="fw-semibold">
                                <a href="tel:{{ teacher.mobile }}" class="text-decoration-none">
                                    {{ teacher.mobile }}
                                </a>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Date of Birth</label>
                            <p class="fw-semibold">{{ teacher.dob|date:"M d, Y"|default:"Not specified" }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Gender</label>
                            <p class="fw-semibold">{{ teacher.get_gender_display|default:"Not specified" }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Blood Group</label>
                            <p class="fw-semibold">{{ teacher.blood_group|default:"Not specified" }}</p>
                        </div>
                        <div class="col-12">
                            <label class="form-label text-custom small">Address</label>
                            <p class="fw-semibold">{{ teacher.address|default:"Not specified"|linebreaks }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Professional Information -->
        <div class="col-lg-6">
            <div class="card card-custom">
                <div class="card-header detail-card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-briefcase me-2"></i>Professional Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Designation</label>
                            <p class="fw-semibold">{{ teacher.get_designation_display }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Faculty Type</label>
                            <p class="fw-semibold">{{ teacher.get_faculty_type_display }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Qualification</label>
                            <p class="fw-semibold">{{ teacher.get_qualification_display }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Specialization</label>
                            <p class="fw-semibold">{{ teacher.specialization|default:"Not specified" }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Date of Joining</label>
                            <p class="fw-semibold">{{ teacher.joining_date|date:"M d, Y" }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Experience</label>
                            <p class="fw-semibold">{{ teacher.get_teaching_experience }} years</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Salary</label>
                            <p class="fw-semibold">₹{{ teacher.salary|default:"0" }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-custom small">Class Teacher</label>
                            <p class="fw-semibold">
                                <span class="badge bg-{% if teacher.is_class_teacher %}success{% else %}secondary{% endif %}">
                                    {{ teacher.is_class_teacher|yesno:"Yes,No" }}
                                </span>
                            </p>
                        </div>
                        {% if teacher.is_class_teacher and teacher.class_teacher_of %}
                        <div class="col-12">
                            <label class="form-label text-custom small">Class Teacher Of</label>
                            <p class="fw-semibold">{{ teacher.class_teacher_of }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Subjects and Teaching -->
        <div class="col-lg-6">
            <div class="card card-custom">
                <div class="card-header detail-card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-book me-2"></i>Subjects & Teaching
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label text-custom small">Subjects Taught</label>
                        <div class="d-flex flex-wrap gap-2">
                            {% for subject in teacher.subjects.all %}
                            <span class="badge bg-primary">{{ subject.name }}</span>
                            {% empty %}
                            <span class="text-custom">No subjects assigned</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-custom small">Teaching Grade Levels</label>
                        <p class="fw-semibold">{{ teacher.teaching_grade_levels|default:"Not specified" }}</p>
                    </div>
                    <div>
                        <label class="form-label text-custom small">Department</label>
                        <p class="fw-semibold">{{ teacher.get_department_display|default:"Not assigned" }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Contact & Documents -->
        <div class="col-lg-6">
            <div class="card card-custom">
                <div class="card-header detail-card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-telephone me-2"></i>Emergency Contact & Documents
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label text-custom small">Emergency Contact</label>
                        <p class="fw-semibold">
                            {{ teacher.emergency_contact }}
                            {% if teacher.emergency_contact_name %}
                            <br><small class="text-custom">({{ teacher.emergency_contact_name }})</small>
                            {% endif %}
                        </p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-custom small">Documents</label>
                        <div class="d-flex flex-wrap gap-2">
                            {% if teacher.resume %}
                            <a href="{{ teacher.resume.url }}" class="btn btn-sm btn-outline-primary" target="_blank">
                                <i class="bi bi-file-earmark-text me-1"></i>Resume
                            </a>
                            {% endif %}
                            {% if teacher.degree_certificates %}
                            <a href="{{ teacher.degree_certificates.url }}" class="btn btn-sm btn-outline-info" target="_blank">
                                <i class="bi bi-file-earmark-pdf me-1"></i>Certificates
                            </a>
                            {% endif %}
                            {% if not teacher.resume and not teacher.degree_certificates %}
                            <span class="text-custom">No documents uploaded</span>
                            {% endif %}
                        </div>
                    </div>
                    <div>
                        <label class="form-label text-custom small">Organization</label>
                        <p class="fw-semibold">{{ teacher.institution.name }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="d-flex gap-2 justify-content-end">
                {% if request.user.is_superadmin %}
                <a href="{% url 'teacher_edit' teacher.pk %}" class="btn btn-primary">
                    <i class="bi bi-pencil me-1"></i> Edit Teacher
                </a>
                <a href="{% url 'teacher_delete' teacher.pk %}" class="btn btn-outline-danger">
                    <i class="bi bi-trash me-1"></i> Delete
                </a>
                {% endif %}
                <a href="{% url 'teacher_list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i> Back to List
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    $('[data-bs-toggle="tooltip"]').tooltip();
});
</script>
{% endblock %}