<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Notice Export - {{ notice.title }}</title>
    <style>
        @page {
            size: A4;
            margin: 10mm;
        }
        body {
            font-family: Arial, sans-serif;
            font-size: 11px;
            color: #333;
            line-height: 1.2;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 5px;
            page-break-inside: avoid;
            table-layout: fixed;
            word-wrap: break-word;
        }
        th, td {
            border: 1px solid #444;
            padding: 3px;
            text-align: left;
            vertical-align: top;
        }
        th {
            background-color: #366092;
            color: #fff;
        }
        .section-title {
            background-color: #f2f2f2;
            font-weight: bold;
            padding: 2px 4px;
            margin-top: 5px;
        }
        footer {
            text-align: center;
            font-size: 10px;
            margin-top: 5px;
        }
        .content-cell {
            word-wrap: break-word;
        }
        .qr-row td {
            border: 0;
            text-align: right;
        }
    </style>
</head>
<body>

<!-- Header with QR Code in separate row -->
<table>
  <tr>
    <td>
       <div class="header">
        {% if logo %}
            <img src="{{ logo}}" alt="Logo" height="50" width="210">
        {% endif %}
        <h1>{{ organization.name }}</h1>
        <h2>{% if single %}Notice{% else %}Notices{% endif %} Report</h2>
        <div class="meta">
            <span>Exported By: {{ user.get_full_name }}</span>
            <span>Date: {{ export_date }}</span>
        </div>
    </div>
    </td>
  </tr>
  {% if qr_code %}
  <tr class="qr-row">
    <td>
        <img src="{{ qr_code }}" width="80" height="80">
    </td>
  </tr>
  {% endif %}
</table>

<!-- Notice Information -->
<table>
    <tr class="section-title"><td colspan="2">Notice Information</td></tr>
    <tr><th>Title</th><td class="content-cell">{{ notice.title }}</td></tr>
    <tr><th>Content</th><td class="content-cell">{{ notice.content }}</td></tr>
    <tr><th>Priority</th><td>{{ notice.priority }}</td></tr>
    <tr><th>Audience</th><td>{{ notice.audience }}</td></tr>
    <tr><th>Published</th><td>{% if notice.is_published %}Yes{% else %}No{% endif %}</td></tr>
    <tr><th>Publish Date</th><td>{{ notice.publish_date }}</td></tr>
    <tr><th>Expiry Date</th><td>{{ notice.expiry_date }}</td></tr>
    <tr><th>Attachment</th><td>{{ notice.attachment }}</td></tr>
    <tr><th>Created By</th><td>{{ notice.created_by }}</td></tr>
    <tr><th>Created At</th><td>{{ notice.created_at }}</td></tr>
</table>

<!-- Audience Statistics -->
<table>
    <tr class="section-title"><td colspan="2">Audience Statistics</td></tr>
    <tr><th>Total Audience</th><td>{{ notice.total_audience }}</td></tr>
    <tr><th>Read</th><td>{{ notice.read_count }}</td></tr>
    <tr><th>Unread</th><td>{{ notice.unread_count }}</td></tr>
    <tr><th>Read Percentage</th><td>{{ notice.read_percentage }}</td></tr>
</table>

<!-- Audience Details -->
<table>
    <tr class="section-title"><td colspan="4">Audience Details</td></tr>
    <tr>
        <th>User</th>
        <th>Email</th>
        <th>Status</th>
        <th>Read At</th>
    </tr>
    {% for audience in audience_details %}
        <tr>
            <td>{{ audience.user.get_full_name }}</td>
            <td>{{ audience.user.email }}</td>
            <td>{% if audience.read %}Read{% else %}Unread{% endif %}</td>
            <td>{% if audience.read_at %}{{ audience.read_at|date:"Y-m-d H:i" }}{% else %}Not Read{% endif %}</td>
        </tr>
    {% endfor %}
</table>

<footer>
    <div class="footer">
            <p>Generated by {{ organization.name }}.</p>
            <p>This is an auto-generated document. Current Time: {{ export_date|date:"Y-m-d H:i:s" }}</p>
             Page <pdf:pagenumber> of <pdf:pagecount> 
         </div>
    </footer>
</body>
</html>
